{"version":3,"file":"hot/hot-update.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAA6D;AAG7D,cAAc;AACd;IAQI,4BAAY,MAAY;QAPxB,SAAI,GAAQ,oBAAoB,CAAC;QACjC,WAAM,GAAQ,EAAE,CAAC;QAGjB,aAAQ,GAAY,KAAK,CAAC;QAE1B,uBAAkB,GAAW,GAAG,CAAC;QAE7B,IAAI,CAAC,MAAM,yBACJ,IAAI,CAAC,MAAM,GACX,MAAM,CACZ;IAEL,CAAC;IACD,yCAAY,GAAZ;QAAA,iBAcC;QAbG,IAAI,EAAE,GAAQ,IAAI,CAAC;QACnB,IAAI,UAAU,GAAG,EAAE,CAAC,YAAY,CAAC;QAEjC,UAAU,CAAC,EAAE,CAAC,iBAAiB,EAAE,UAAC,QAAa;YAC3C,IAAI,CAAC,KAAI,CAAC,gBAAgB,EAAE;gBACxB,EAAE,CAAC,MAAM,EAAE,CAAC;gBACZ,KAAI,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,EAAE,EAAE,QAAQ,CAAC;gBACrC,sDAAsD;gBACtD,cAAc;gBACd,KAAI,CAAC,gBAAgB,GAAG,IAAI,4DAAwB,CAAC,KAAI,CAAC,MAAM,CAAC,CAAC;aACrE;QACL,CAAC,CAAC,CAAC;IAEP,CAAC;IACD,mCAAM,GAAN;QAAA,iBA2GC;QAzGG,IAAI,EAAE,GAAQ,IAAI,CAAC;QACnB,IAAI,CAAC,CAAC,GAAG,EAAE,CAAC,YAAY,CAAC,CAAC,CAAC;QAC3B,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAE/B,qCAAqC;QACrC,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW,EAAE,UAAC,EAAc;gBAAZ,KAAK;YACpC,IAAI,KAAK,CAAC,OAAO,KAAK,EAAE,IAAI,KAAK,CAAC,KAAK,IAAI,EAAE,IAAI,KAAK,CAAC,KAAK,IAAI,EAAE,IAAI,KAAK,CAAC,KAAK,IAAI,EAAE,IAAI,KAAK,CAAC,KAAK,IAAI,GAAG,IAAI,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,KAAK,WAAW,EAAE;gBACtK,IAAI,CAAC,KAAI,CAAC,QAAQ,EAAE;oBAChB,IAAI,YAAY,GAAQ,EAAE,CAAC;oBAC3B,YAAY,CAAC,OAAO,CAAC,GAAG,QAAQ,CAAC;oBACjC,YAAY,CAAC,SAAS,CAAC,GAAG;wBACtB,MAAM,EAAE,EAAE;wBACV,MAAM,EAAE,EAAE;qBACb;oBACD,YAAY,CAAC,YAAY,CAAC,GAAG,cAAc,CAAC;oBAC5C,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,UAAC,GAAQ;wBACnD,IAAI,GAAG,IAAI,GAAG,CAAC,OAAO,EAAE;4BACpB,OAAO,CAAC,GAAG,CAAC,wBAAwB,EAAE,GAAG,EAAE,KAAK,CAAC,OAAO,CAAC;yBAC5D;oBACL,CAAC,CAAC,CAAC;oBACH,KAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;iBACxB;gBACD,YAAY,CAAC,KAAI,CAAC,WAAW,CAAC,CAAC;gBAC/B,KAAI,CAAC,WAAW,GAAG,UAAU,CAAC,cAAM,SAAE,CAAC,mBAAmB,EAAE,EAAxB,CAAwB,EAAE,KAAI,CAAC,kBAAkB,CAAC,CAAC;aAG1F;iBAAM,IAAI,KAAK,CAAC,OAAO,KAAK,EAAE,EAAE;gBAC7B,YAAY,CAAC,KAAI,CAAC,WAAW,CAAC;gBAC9B,EAAE,CAAC,mBAAmB,EAAE;aAC3B;QACL,CAAC,CAAC,CAAC;QAEH,0CAA0C;QAC1C,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,aAAa,EAAE,UAAC,KAAU;;YAEzC,gBAAgB;YAChB,IAAI,kBAAK,CAAC,WAAW,0CAAE,OAAO,0CAAE,IAAI,MAAK,iBAAiB,EAAE;gBACxD,YAAY,CAAC,OAAO,CAAC,iBAAiB,EAAE,WAAW,CAAC;aACvD;iBAAM,IAAI,kBAAK,CAAC,WAAW,0CAAE,OAAO,0CAAE,IAAI,MAAK,oBAAoB,EAAE;gBAClE,YAAY,CAAC,OAAO,CAAC,iBAAiB,EAAE,aAAa,CAAC;aACzD;YAED,6DAA6D;YAC7D,IAAI,wBAAK,CAAC,WAAW,0CAAE,OAAO,0CAAE,MAAM,0CAAE,IAAI,MAAK,OAAO,IAAI,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,KAAK,QAAQ,IAAI,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,KAAK,WAAW,EAAE;gBAChK,KAAI,CAAC,CAAC,CAAC,yBAAyB,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;gBAC1D,KAAI,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;aAC1D;iBAAM,IAAI,wBAAK,CAAC,WAAW,0CAAE,OAAO,0CAAE,MAAM,0CAAE,IAAI,MAAK,OAAO,IAAI,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,KAAK,YAAY,IAAI,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,KAAK,WAAW,EAAE;gBAC3K,KAAI,CAAC,CAAC,CAAC,yBAAyB,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;aAC5D;iBAAM,IAAI,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,KAAK,UAAU,EAAE;gBAC/D,KAAI,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;aAC7D;QACL,CAAC,CAAC,CAAC;QAEH,yCAAyC;QACzC,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,oBAAoB,EAAE,UAAC,KAAU;;YAEhD,IAAI,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAAI,WAAW;gBAAE,OAAO;YAEnE,IAAI,YAAK,CAAC,OAAO,0CAAE,IAAI,MAAK,aAAa,EAAE;gBACvC,gDAAgD;gBAChD,KAAI,CAAC,CAAC,CAAC,yBAAyB,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;gBAEzD,IAAM,KAAG,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC;gBAClC,IAAM,YAAY,GAAG,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;gBAC3D,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC,MAAM,EAAE;oBACjD,YAAY,CAAC,MAAM,CAAC,mCAAmC,CAAC,CAAC;oBAEzD,0EAA0E;oBAC1E,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,CAAC,SAAS,EAAE,UAAC,OAAY;wBAC3C,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;wBACxC,IAAI,CAAC,QAAQ;4BAAE,OAAO;wBACtB,IAAI,QAAQ,CAAC,IAAI,KAAK,KAAK,IAAI,QAAQ,CAAC,IAAI,KAAK,QAAQ,IAAI,QAAQ,CAAC,OAAO,CAAC,eAAe,KAAK,KAAG,CAAC,CAAC,CAAC,CAAC,eAAe,EAAE;4BACtH,IAAI,GAAG,GAAG,KAAI,CAAC,CAAC,CAAC,GAAG,GAAG,QAAQ,CAAC,OAAO,CAAC,eAAe,GAAG,iBAAiB,CAAC,CAAC;4BAC7E,IAAI,QAAQ,CAAC,OAAO,CAAC,IAAI,KAAK,mBAAmB,EAAE;gCAC/C,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;oCACvB,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;iCAC7B;6BACJ;iCAAM,IAAI,QAAQ,CAAC,OAAO,CAAC,IAAI,KAAK,cAAc,EAAE;gCACjD,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;6BACjD;yBAEJ;oBACL,CAAC,CAAC,CAAC;iBACN;aACJ;iBAAM;gBACH,sCAAsC;gBACtC,IAAI,8BAAK,CAAC,OAAO,0CAAE,OAAO,CAAC,CAAC,CAAC,0CAAE,SAAS,0CAAE,OAAO,0CAAE,aAAa,KAAI,YAAY,EAAE;oBAC9E,IAAM,YAAY,GAAQ,EAAE,CAAC;oBAE7B,IAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC;oBACtC,YAAY,CAAC,OAAO,CAAC,GAAG,mBAAmB,CAAC;oBAC5C,YAAY,CAAC,SAAS,CAAC,GAAG;wBACtB,MAAM,EAAE,EAAE;wBACV,MAAM,EAAE,EAAE;qBACb;oBACD,YAAY,CAAC,YAAY,CAAC,GAAG,cAAc,CAAC;oBAC5C,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,UAAC,GAAQ,IAAO,CAAC,CAAC,CAAC;oBAEjE,IAAI,KAAI,CAAC,CAAC,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,EAAE;wBACpC,YAAY,CAAC,KAAK,GAAG,cAAc;wBACnC,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,UAAC,GAAQ,IAAO,CAAC,CAAC,CAAC;qBACpE;iBACJ;aACJ;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED,oDAAuB,GAAvB;QACI,IAAI,EAAE,GAAQ,IAAI,CAAC;QACnB,IAAI,UAAU,GAAG,EAAE,CAAC,YAAY,CAAC;QACjC,IAAI,OAAO,GAAG,UAAU,CAAC,OAAO,CAAC;QACjC,IAAI,iBAAiB,GAAG,oGAAoG,CAAC;QAC7H,IAAI,kBAAkB,GAAG,qGAAqG,CAAC;QAC/H,OAAO,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QAClC,OAAO,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;IACvC,CAAC;IAED,mCAAM,GAAN,UAAO,MAAW,EAAE,MAAW;QAC3B,IAAI,EAAE,GAAQ,IAAI,CAAC;QACnB,KAAK,IAAI,IAAI,IAAI,MAAM,EAAE;YACrB,IAAI,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;gBAC7B,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,KAAK,QAAQ,EAAE;oBAClD,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;iBACzC;qBACI;oBACD,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;iBAC/B;aACJ;SACJ;QACD,OAAO,MAAM,CAAC;IAClB,CAAC;IAED,gDAAmB,GAAnB;QACI,IAAM,EAAE,GAAQ,IAAI,CAAC;QACrB,IAAI,YAAY,GAAQ,EAAE,CAAC;QAC3B,YAAY,CAAC,OAAO,CAAC,GAAG,aAAa,CAAC;QACtC,YAAY,CAAC,SAAS,CAAC,GAAG;YACtB,MAAM,EAAE,EAAE;YACV,MAAM,EAAE,EAAE;SACb;QACD,YAAY,CAAC,YAAY,CAAC,GAAG,cAAc,CAAC;QAC5C,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,UAAC,GAAQ;YACnD,IAAI,GAAG,IAAI,GAAG,CAAC,OAAO,EAAE;gBACpB,OAAO,CAAC,GAAG,CAAC,wBAAwB,EAAE,GAAG,CAAC;aAC7C;QACL,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;IAC1B,CAAC;IACL,yBAAC;AAAD,CAAC;AACD,iEAAe,kBAAkB,EAAC;;;;;;;;;UCzLlC","sources":["webpack://kore-web-sdk/./src/plugins/agentDesktop/agentdesktop.ts","webpack://kore-web-sdk/webpack/runtime/getFullHash"],"sourcesContent":["import AgentDesktopPluginScript from './agentdesktop-script';\n\n\n/** @ignore */\nclass AgentDesktopPlugin {\n    name: any = 'AgentDesktopPlugin';\n    config: any = {};\n    agentDesktopInfo: any;\n    $: any;\n    isTyping: boolean = false;\n    typingTimer: any;\n    stopTypingInterval: number = 500;\n    constructor(config?: any) {\n        this.config = {\n            ...this.config,\n            ...config\n        }\n\n    }\n    onHostCreate() {\n        let me: any = this;\n        let cwInstance = me.hostInstance;\n\n        cwInstance.on(\"jwtGrantSuccess\", (response: any) => {\n            if (!this.agentDesktopInfo) {\n                me.onInit();\n                this.config = me.extend(me, response)\n                //me.AgentDesktop(response.userInfo.userId, response);\n                /** @ignore */\n                this.agentDesktopInfo = new AgentDesktopPluginScript(this.config);\n            }\n        });\n\n    }\n    onInit() {\n\n        let me: any = this;\n        this.$ = me.hostInstance.$;\n        this.appendVideoAudioElemnts();\n\n        // send type event from user to agent\n        me.hostInstance.on('onKeyDown', ({ event }: any) => {\n            if (event.keyCode !== 13 && event.which <= 90 && event.which >= 48 || event.which >= 96 && event.which <= 105 && localStorage.getItem(\"kr-agent-status\") === \"connected\") {\n                if (!this.isTyping) {\n                    var messageToBot: any = {};\n                    messageToBot[\"event\"] = \"typing\";\n                    messageToBot[\"message\"] = {\n                        \"body\": \"\",\n                        \"type\": \"\"\n                    }\n                    messageToBot[\"resourceid\"] = \"/bot.message\";\n                    me.hostInstance.bot.sendMessage(messageToBot, (err: any) => {\n                        if (err && err.message) {\n                            console.log(\"Failed to send reciept\", err, event.msgData)\n                        }\n                    });\n                    this.isTyping = true;\n                }\n                clearTimeout(this.typingTimer);\n                this.typingTimer = setTimeout(() => me.sendStopTypingEvent(), this.stopTypingInterval);\n\n\n            } else if (event.keyCode === 13) {\n                clearTimeout(this.typingTimer)\n                me.sendStopTypingEvent()\n            }\n        });\n\n        // agent connected and disconnected events\n        me.hostInstance.on('onWSMessage', (event: any) => {\n\n            // Agent Status \n            if (event.messageData?.message?.type === 'agent_connected') {\n                localStorage.setItem(\"kr-agent-status\", \"connected\")\n            } else if (event.messageData?.message?.type === 'agent_disconnected') {\n                localStorage.setItem(\"kr-agent-status\", \"disconneted\")\n            }\n\n            // type indicator style changes when agent is being connected\n            if (event.messageData?.message?.author?.type === 'AGENT' && event.messageData.message.type === 'typing' && localStorage.getItem(\"kr-agent-status\") === \"connected\") {\n                this.$('.typingIndicatorContent').css('display', 'block');\n                this.$('.typingIndicator').addClass('agent-type-icon');\n            } else if (event.messageData?.message?.author?.type === 'AGENT' && event.messageData.message.type === 'stoptyping' && localStorage.getItem(\"kr-agent-status\") === \"connected\") {\n                this.$('.typingIndicatorContent').css('display', 'none');\n            } else if (localStorage.getItem(\"kr-agent-status\") !== \"conneted\") {\n                this.$('.typingIndicator').removeClass('agent-type-icon');\n            }\n        });\n\n        // sent event style setting in user chat \n        me.hostInstance.on('afterRenderMessage', (event: any) => {\n\n            if (localStorage.getItem(\"kr-agent-status\") != \"connected\") return;\n\n            if (event.msgData?.type === \"currentUser\") {\n                // remove bot typing while agent being connected\n                this.$('.typingIndicatorContent').css('display', 'none');\n\n                const msg = event.msgData.message;\n                const extraInfoEle = event.messageHtml.find('.extra-info');\n                if (!extraInfoEle.children('.sentIndicator').length) {\n                    extraInfoEle.append('<div class=\"sentIndicator\"></div>');\n\n                    // changing indicator text for specific message on deliver and read events\n                    me.hostInstance.bot.on('message', (message: any) => {\n                        var tempData = JSON.parse(message.data);\n                        if (!tempData) return;\n                        if (tempData.from === \"bot\" && tempData.type === \"events\" && tempData.message.clientMessageId === msg[0].clientMessageId) {\n                            var ele = this.$(\"#\" + tempData.message.clientMessageId + \" .sentIndicator\");\n                            if (tempData.message.type === \"message_delivered\") {\n                                if (!ele.hasClass('read')) {\n                                    ele.addClass(\"delivered\");\n                                }\n                            } else if (tempData.message.type === \"message_read\") {\n                                ele.removeClass(\"delivered\").addClass(\"read\");\n                            }\n\n                        }\n                    });\n                }\n            } else {\n                // send read event from user to agent \n                if (event.msgData?.message[0]?.component?.payload?.template_type == 'live_agent') {\n                    const messageToBot: any = {};\n\n                    const msgId = event.msgData.messageId;\n                    messageToBot[\"event\"] = \"message_delivered\";\n                    messageToBot[\"message\"] = {\n                        \"body\": \"\",\n                        \"type\": \"\"\n                    }\n                    messageToBot[\"resourceid\"] = \"/bot.message\";\n                    me.hostInstance.bot.sendMessage(messageToBot, (err: any) => { });\n\n                    if (this.$('#' + msgId).is(':visible')) {\n                        messageToBot.event = 'message_read'\n                        me.hostInstance.bot.sendMessage(messageToBot, (err: any) => { });\n                    }\n                }\n            }\n        });\n    }\n\n    appendVideoAudioElemnts() {\n        let me: any = this;\n        let cwInstance = me.hostInstance;\n        let chatEle = cwInstance.chatEle;\n        let localVideoElement = '<video id=\"kore_local_video\" autoplay=\"autoplay\" playsinline style=\"width:0px;height:0px\"></video>';\n        let remoteVideoElement = '<video id=\"kore_remote_video\" autoplay=\"autoplay\" playsinline style=\"width:0px;height:0px\"></video>';\n        chatEle.append(localVideoElement);\n        chatEle.append(remoteVideoElement);\n    }\n\n    extend(target: any, source: any) {\n        let me: any = this;\n        for (var prop in source) {\n            if (source.hasOwnProperty(prop)) {\n                if (target[prop] && typeof source[prop] === 'object') {\n                    me.extend(target[prop], source[prop]);\n                }\n                else {\n                    target[prop] = source[prop];\n                }\n            }\n        }\n        return target;\n    }\n\n    sendStopTypingEvent() {\n        const me: any = this;\n        var messageToBot: any = {};\n        messageToBot[\"event\"] = \"stop_typing\";\n        messageToBot[\"message\"] = {\n            \"body\": \"\",\n            \"type\": \"\"\n        }\n        messageToBot[\"resourceid\"] = \"/bot.message\";\n        me.hostInstance.bot.sendMessage(messageToBot, (err: any) => {\n            if (err && err.message) {\n                console.log(\"Failed to send reciept\", err)\n            }\n        });\n        this.isTyping = false;\n    }\n}\nexport default AgentDesktopPlugin;","__webpack_require__.h = () => (\"db32b4d4adce7042361e\")"],"names":[],"sourceRoot":""}
