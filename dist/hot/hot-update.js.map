{"version":3,"file":"hot/hot-update.js","mappings":"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","sources":["webpack://kore-web-sdk/./src/plugins/textToSpeech/KoreAWSPolly/kore-aws-polly.ts","webpack://kore-web-sdk/webpack/runtime/getFullHash"],"sourcesContent":["import BaseTTS from \"../BaseTTS\";\r\nimport * as AWS from 'aws-sdk';\r\ndeclare const document: any;\r\ndeclare const window: any;\r\nexport interface SpeakTextAWSPollyConfig {\r\n    region:string;\r\n    identityCredentials:any;\r\n}\r\n\r\nclass SpeakTextWithAWSPolly extends BaseTTS {\r\n    name = 'speakTextWithAWSPollyClass';\r\n    \r\n    config:any;\r\n    queue: any;\r\n    audioStatus: string | undefined;\r\n\r\n    constructor(mainConfig:SpeakTextAWSPollyConfig){\r\n        super();\r\n\r\n        if(!mainConfig.identityCredentials){\r\n            console.error('Please configure the AWS Identity credentials');\r\n        }\r\n     \r\n        this.config = {\r\n            'AWS.config.region': mainConfig.region || 'ap-south-1',\r\n            'AWS.config.credentials': new AWS.CognitoIdentityCredentials(mainConfig.identityCredentials)\r\n        };\r\n    }\r\n\r\n    onHostCreate() {\r\n        let me: any = this;\r\n        let cwInstance = me.hostInstance;\r\n        cwInstance.on(\"viewInit\", (chatWindowEle: any) => {\r\n            me.onInit();\r\n        });\r\n    }\r\n    onInit() {\r\n        let me = this;\r\n        me.installTextToSpeechTemplate();\r\n        setInterval(function () {\r\n            me.checkForQueue();\r\n        }, 300);\r\n        me.initAudioContext();\r\n    }\r\n\r\n    checkForQueue() {\r\n        var me = this;\r\n        if (this.queue && this.queue.length && this.audioStatus === 'idle') {\r\n            var currentUtterance = this.queue.shift();\r\n            me.speakTextReq(currentUtterance)\r\n        }\r\n    }\r\n\r\n    speakTextReq(textToSpeak: any) {\r\n        var me = this;\r\n        this.audioStatus = 'busy';\r\n        // Create the JSON parameters for getSynthesizeSpeechUrl\r\n        var speechParams = {\r\n            OutputFormat: \"mp3\",\r\n            SampleRate: \"16000\",\r\n            Text: \"\",\r\n            TextType: \"text\",\r\n            VoiceId: \"Joanna\"//Salli | Joanna | Ivy | Kendra | Kimberly | Matthew | Justin |Joey\r\n        };\r\n        speechParams.Text = textToSpeak;//document.getElementById(\"textEntry\").value;\r\n\r\n        // Create the Polly service object and presigner object\r\n        var polly: any = new AWS.Polly({ apiVersion: '2016-06-10' });\r\n        var signer = new (AWS.Polly.Presigner as any)(speechParams, polly)\r\n\r\n        // Create presigned URL of synthesized speech file\r\n        signer.getSynthesizeSpeechUrl(speechParams, function (error: any, url: any) {\r\n            if (error) {\r\n                document.getElementById('result').innerHTML = error;\r\n            } else {\r\n                me.playFromUrl(url);\r\n            }\r\n        });\r\n    }\r\n\r\n    initAudioContext() {\r\n        window.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n        window.audioContext = new AudioContext();\r\n        window.gainNode = window.audioContext.createGain()\r\n        navigator.mediaDevices.getUserMedia({ audio: true })\r\n        .then(function (stream) {\r\n            window.audioContext.resume().then(function (res: any) {\r\n\r\n            });\r\n        })\r\n        .catch(function (err) {\r\n            console.log('Audio permissions denied by user');\r\n        });\r\n    }\r\n\r\n    playFromUrl(URL: any) {\r\n        var me = this;\r\n        const request = new XMLHttpRequest();\r\n        request.open('GET', URL, true);\r\n        request.responseType = 'arraybuffer';\r\n        request.onload = function onLoad() {\r\n            const Data = request.response;\r\n            me.process(Data);\r\n        };\r\n        request.send();\r\n    }\r\n\r\n    process(Data: any) {\r\n        const source = window.audioContext.createBufferSource();\r\n        window.audioContext.decodeAudioData(Data, (buffer: any) => {\r\n            source.buffer = buffer;\r\n            window.gainNode.connect(window.audioContext.destination)\r\n            // now instead of connecting to aCtx.destination, connect to the gainNode\r\n            source.connect(window.gainNode)\r\n\r\n            source.start(window.audioContext.currentTime);\r\n            source.onended = function () {\r\n                this.audioStatus = 'idle'\r\n                console.log('Your audio has finished playing');\r\n            }\r\n        });\r\n    }\r\n\r\n    speakTextWithAWSPolly(textToSpeak:any) {\r\n        this.queue.push(textToSpeak);\r\n        this.checkForQueue();\r\n    }\r\n\r\n    OnSpeakerButtonClick() {\r\n        let me: any = this;\r\n        let $ = me.hostInstance.$;\r\n        let cwInstance = me.hostInstance;\r\n        if (!$('.ttspeakerDiv').hasClass('ttsOff')) {\r\n            var synth = window.speechSynthesis;\r\n            synth.pause();\r\n            $('.ttspeakerDiv').addClass('ttsOff');\r\n        } else {\r\n            $('.ttspeakerDiv').removeClass('ttsOff');\r\n            cwInstance.on(\"afterRenderMessage\", (chatWindowData: { msgData: any; }) => {\r\n                var msgData = chatWindowData.msgData;\r\n                if (msgData?.type === \"bot_response\" && !me.hostInstance.minimized && !me.hostInstance.historyLoading) {\r\n                    if (msgData.message[0] && msgData.message[0].component && msgData.message[0].component.type === \"template\") {\r\n                        (<any>this)._txtToSpeak = '';\r\n                    }\r\n                    else {\r\n                        try {\r\n                            (<any>this)._txtToSpeak = msgData.message[0].component.payload.text ? msgData.message[0].component.payload.text.replace(/\\r?\\n/g, \". .\") : \"\";\r\n                            (<any>this)._txtToSpeak = me.hostInstance.helpers.checkMarkdowns((<any>this)._txtToSpeak);\r\n                            // replacing extra new line or line characters\r\n                            (<any>this)._txtToSpeak = (<any>this)._txtToSpeak.replace('___', '<hr/>');\r\n                            (<any>this)._txtToSpeak = (<any>this)._txtToSpeak.replace('---', '<hr/>');\r\n                        } catch (e) {\r\n                            (<any>this)._txtToSpeak = '';\r\n                        }\r\n                    }\r\n                    if (msgData.message[0].component && msgData.message[0].component.payload.speech_hint) {\r\n                        (<any>this)._txtToSpeak = msgData.message[0].component.payload.speech_hint;\r\n                    }\r\n\r\n                    me.speakTextWithAWSPolly((<any> this)._txtToSpeakToSpeak)\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n}\r\nexport default SpeakTextWithAWSPolly;","__webpack_require__.h = () => (\"9e9318e426082f6bdb22\")"],"names":[],"sourceRoot":""}